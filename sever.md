# 管理者向け仕様書

## 概要

本書は，ドラゴンクエストⅢ管理システムを運用する管理者向けの仕様書である．システムのインストールから起動，終了までの手順を説明する．

## 動作環境

| 項目 | 要件 |
|-|-|
| OS | Windows 10/11，macOS，Linux |
| Node.js | v18.0.0 以上 |
| npm | v9.0.0 以上 |
| ブラウザ | Chrome，Firefox，Safari，Edge（最新版） |

---

## インストール方法

### 1. Node.jsのインストール

Node.jsがインストールされていない場合は，以下の手順でインストールする．

1. [Node.js公式サイト](https://nodejs.org/)にアクセスする
2. LTS版をダウンロードする
3. インストーラを実行し，指示に従ってインストールする

インストール後，ターミナル（コマンドプロンプト）で以下のコマンドを実行し，バージョンを確認する．

```bash
node -v
npm -v
```

### 2. プロジェクトの配置

1. `webpro_06.zip`を任意のフォルダに解凍する
2. 解凍すると以下のフォルダ構成になる

```text
webpro_06/
├── app.js
├── package.json
├── data/
│   ├── monsters.js
│   ├── items.js
│   └── spells.js
├── views/
│   ├── index.ejs
│   ├── monsters/
│   ├── items/
│   └── spells/
└── public/
    └── style.css
```

### 3. 依存パッケージのインストール

ターミナルで`webpro_06`フォルダに移動し，以下のコマンドを実行する．

```bash
cd webpro_06
npm install
```

以下のように表示されれば成功である．

```text
added 83 packages, and audited 84 packages in 4s
found 0 vulnerabilities
```

---

## 起動方法

### サーバの起動

`webpro_06`フォルダ内で以下のコマンドを実行する．

```bash
node app.js
```

以下のメッセージが表示されれば，サーバが正常に起動している．

```text
サーバ起動中: http://localhost:8080
```

### 動作確認

Webブラウザを開き，以下のURLにアクセスする．

```text
http://localhost:8080
```

ポータルページが表示されれば，システムは正常に動作している．

---

## 終了方法

サーバを終了するには，ターミナルで`Ctrl + C`を押す．

以下のようにプロンプトが戻れば，サーバは終了している．

```text
^C
$
```

---

## 起動できない場合

### エラー：「Error: Cannot find module 'express'」

**原因**：依存パッケージがインストールされていない．

**対処法**：以下のコマンドを実行する．

```bash
npm install
```

### エラー：「Error: listen EADDRINUSE: address already in use :::8080」

**原因**：ポート8080が他のアプリケーションで使用されている．

**対処法**：以下のいずれかを行う．

1. ポート8080を使用しているアプリケーションを終了する
2. `app.js`の`PORT`変数を別の番号（例：3000）に変更する

```javascript
const PORT = 3000;  // 8080から変更
```

### エラー：「node: command not found」

**原因**：Node.jsがインストールされていない，またはパスが通っていない．

**対処法**：Node.jsを再インストールする．

### ページが表示されない

**原因**：URLが間違っている，またはサーバが起動していない．

**対処法**：

1. ターミナルに「サーバ起動中」のメッセージが表示されているか確認する
2. URLが`http://localhost:8080`になっているか確認する（`https`ではなく`http`）

---

## ポート番号の変更

デフォルトのポート番号は`8080`である．変更する場合は，`app.js`の以下の行を編集する．

```javascript
const PORT = 8080;  // この数字を変更する
```

変更後，サーバを再起動する必要がある．

---

## データの初期化

データを初期状態に戻したい場合は，サーバを終了してから再起動する．本システムはデータを変数内に保存しているため，サーバを再起動するとデータは初期状態に戻る．

---

## 分かっている不具合

| 不具合 | 内容 | 回避方法 |
|-|-|-|
| データの永続化 | サーバを再起動するとデータが初期状態に戻る | サーバを起動したままにする |
| 同時アクセス | 複数ユーザーが同時に編集すると競合する可能性がある | 単一ユーザーでの使用を推奨 |
| 入力検証 | 不正な値（負の数など）が入力できる | 正しい値を入力する |

---

## ログの確認

サーバのアクセスログはターミナルには出力されない．必要に応じて，`app.js`にログ出力機能を追加すること．

---

## セキュリティに関する注意

本システムは学習用であり，以下の点に注意すること．

- 本システムをインターネット上に公開しないこと
- 認証機能がないため，誰でもデータの追加・編集・削除が可能である
- 入力値のサニタイズが十分でないため，XSS攻撃に脆弱である

---

## 問い合わせ先

本システムに関する問い合わせは，GitHubリポジトリのIssueにて受け付ける．

リポジトリURL：（レポート提出時に記載）